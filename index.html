<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moody Mirror - Facial Roaster</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.11.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/face-landmarks-detection@0.0.1/dist/face-landmarks-detection.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-x: hidden;
        }
        
        .container {
            width: 100%;
            max-width: 900px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            color: white;
        }
        
        header {
            background: rgba(0, 0, 0, 0.85);
            padding: 20px;
            text-align: center;
            border-bottom: 3px solid #ff6b6b;
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            background: linear-gradient(to right, #ff6b6b, #feca57, #1dd1a1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .content {
            display: flex;
            flex-direction: column;
            padding: 30px;
        }
        
        @media (min-width: 768px) {
            .content {
                flex-direction: row;
            }
        }
        
        .camera-section {
            flex: 1;
            position: relative;
            margin-right: 20px;
        }
        
        #video {
            width: 100%;
            border-radius: 15px;
            background: black;
            transform: scaleX(-1);
            display: none;
        }
        
        #canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 15px;
            transform: scaleX(-1);
        }
        
        .placeholder {
            background: #333;
            border-radius: 15px;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #777;
            font-size: 1.2rem;
            text-align: center;
            padding: 20px;
        }
        
        .roast-section {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .status {
            background: rgba(50, 50, 50, 0.7);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .expression {
            font-size: 2rem;
            font-weight: bold;
            margin: 10px 0;
            color: #feca57;
        }
        
        .roast-display {
            background: rgba(30, 30, 30, 0.9);
            border-radius: 15px;
            padding: 25px;
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 1.8rem;
            min-height: 200px;
            border: 2px solid #ff6b6b;
            box-shadow: 0 0 20px rgba(255, 107, 107, 0.3);
        }
        
        .roast-text {
            color: #ff6b6b;
            font-weight: bold;
            line-height: 1.4;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 25px;
        }
        
        button {
            padding: 12px 25px;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            outline: none;
        }
        
        #startBtn {
            background: linear-gradient(to right, #1dd1a1, #10ac84);
            color: white;
        }
        
        #startBtn:hover {
            background: linear-gradient(to right, #10ac84, #1dd1a1);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(16, 172, 132, 0.4);
        }
        
        #roastBtn {
            background: linear-gradient(to right, #ff9f43, #ff6b6b);
            color: white;
        }
        
        #roastBtn:hover {
            background: linear-gradient(to right, #ff6b6b, #ff9f43);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }
        
        .instructions {
            background: rgba(50, 50, 50, 0.7);
            border-radius: 15px;
            padding: 20px;
            margin-top: 25px;
            font-size: 0.95rem;
        }
        
        .instructions h3 {
            color: #feca57;
            margin-bottom: 10px;
        }
        
        .instructions ul {
            padding-left: 20px;
        }
        
        .instructions li {
            margin-bottom: 8px;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.85);
            border-top: 3px solid #1dd1a1;
            font-size: 0.9rem;
            color: #aaa;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 5px solid #feca57;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Moody Mirror</h1>
            <p class="subtitle">Your facial expression roaster - Prepare to be roasted!</p>
        </header>
        
        <div class="content">
            <div class="camera-section">
                <video id="video" autoplay playsinline></video>
                <canvas id="canvas"></canvas>
                <div class="placeholder" id="placeholder">
                    Camera feed will appear here once started
                </div>
            </div>
            
            <div class="roast-section">
                <div class="status">
                    <h2>CURRENT STATUS</h2>
                    <div class="expression" id="expression">Neutral</div>
                    <div>Confidence: <span id="confidence">80%</span></div>
                </div>
                
                <div class="roast-display">
                    <div class="roast-text" id="roast">
                        Click "Start Camera" and then "Roast Me!" when ready
                    </div>
                </div>
            </div>
        </div>
        
        <div class="controls">
            <button id="startBtn">Start Camera</button>
            <button id="roastBtn">Roast Me!</button>
        </div>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Loading AI models... This may take a moment</p>
        </div>
        
        <div class="instructions">
            <h3>How to use Moody Mirror:</h3>
            <ul>
                <li>Click "Start Camera" to enable your webcam (grant permission when asked)</li>
                <li>Position your face in the camera view - make sure your face is well-lit</li>
                <li>Make an expression - happy, sad, angry, surprised, or disgusted</li>
                <li>Click "Roast Me!" to get your personalized roast based on your expression</li>
                <li>Try different expressions to get different roasts!</li>
            </ul>
        </div>
        
        <footer>
            <p>Built with TensorFlow.js - Entirely in your browser (no backend required) | Moody Mirror v1.0</p>
        </footer>
    </div>

    <script>
        // DOM Elements
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const placeholder = document.getElementById('placeholder');
        const startBtn = document.getElementById('startBtn');
        const roastBtn = document.getElementById('roastBtn');
        const roastDisplay = document.getElementById('roast');
        const expressionDisplay = document.getElementById('expression');
        const confidenceDisplay = document.getElementById('confidence');
        const loading = document.getElementById('loading');
        
        // Canvas context
        const ctx = canvas.getContext('2d');
        
        // Roasts database
        const roasts = {
            happy: [
                "Someone's a little too cheerful... Did you find a penny on the sidewalk?",
                "That grin is so forced, I can see your soul crying behind it.",
                "You look like someone who laughs at their own jokes. How sad.",
                "Are you happy or did you just forget how to turn off smile mode?",
                "That smile is so fake, I think I saw it on sale at Walmart."
            ],
            sad: [
                "Cheer up! Or don't. Honestly, I don't care either way.",
                "You look like a sad puppy. A really, really ugly sad puppy.",
                "Is that your natural face or did someone steal your lunch money?",
                "You look like you just realized your favorite show got canceled.",
                "That expression says 'I forgot to save my work before closing'."
            ],
            angry: [
                "Whoa, someone woke up on the wrong side of the ugly tree!",
                "Is that anger or did you just smell your own cooking?",
                "You look like you're about to yell at a barista for spelling your name wrong.",
                "Did someone use the last of the coffee? Or are you always this pleasant?",
                "If looks could kill, you'd probably just give someone a mild rash."
            ],
            surprised: [
                "What's the matter? Did you just realize how much time you waste online?",
                "You look like you just saw a ghost... or your own reflection.",
                "That expression says 'I left the oven on' but your face says 'I never cook'.",
                "Surprised? Did you actually accomplish something today?",
                "You look like someone just told you the earth isn't flat."
            ],
            disgusted: [
                "Did you just smell your own breath? I don't blame you for that face.",
                "You look like you just watched someone put pineapple on pizza.",
                "That expression says 'I stepped in something' but your face says 'I am something'.",
                "Is that disgust or your natural resting face? Hard to tell.",
                "You look like you just tasted 'healthy' ice cream."
            ],
            fearful: [
                "Relax, it's just an AI judging you. What could possibly go wrong?",
                "You look like you just realized your search history isn't private.",
                "Is that fear or did you remember that embarrassing thing from 5 years ago?",
                "Don't be scared, I'm sure you're only slightly below average!",
                "You look like someone just said 'we need to talk'."
            ],
            neutral: [
                "Wow, what an expression... said no one ever.",
                "Your face is so neutral, even beige is jealous.",
                "You look like you're contemplating what to order from a menu you've seen 100 times.",
                "That expression says 'I forgot why I walked into this room'.",
                "If boredom had a face... oh wait, I'm looking at it."
            ]
        };
        
        // Current expression tracking
        let currentExpression = 'neutral';
        let modelLoaded = false;
        
        // Initialize face detection
        async function initFaceDetection() {
            try {
                loading.style.display = 'block';
                
                // Load models
                await faceLandmarksDetection.load(
                    faceLandmarksDetection.SupportedPackages.mediapipeFacemesh
                );
                
                modelLoaded = true;
                loading.style.display = 'none';
                
                // Set canvas size
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                
                // Start detection loop
                detectFace();
            } catch (error) {
                console.error('Error loading models:', error);
                loading.style.display = 'none';
                roastDisplay.textContent = "Failed to load AI models. Please refresh the page.";
            }
        }
        
        // Detect face expressions
        async function detectFace() {
            if (!modelLoaded) return;
            
            try {
                const predictions = await faceLandmarksDetection.detectFaces(video, {
                    runtime: 'mediapipe',
                    solutionPath: 'https://cdn.jsdelivr.net/npm/mediapipe-facemesh@0.4'
                });
                
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                if (predictions.length > 0) {
                    const face = predictions[0];
                    
                    // Draw face mesh
                    ctx.strokeStyle = '#ff6b6b';
                    ctx.lineWidth = 1;
                    
                    face.scaledMesh.forEach(point => {
                        ctx.beginPath();
                        ctx.arc(point[0], point[1], 1, 0, 2 * Math.PI);
                        ctx.stroke();
                    });
                    
                    // Update expression
                    if (face.faceExpression) {
                        const expressions = face.faceExpression.expressions;
                        const maxExpression = Object.keys(expressions).reduce((a, b) => 
                            expressions[a] > expressions[b] ? a : b
                        );
                        
                        currentExpression = maxExpression;
                        const confidence = Math.round(expressions[maxExpression] * 100);
                        
                        expressionDisplay.textContent = maxExpression.charAt(0).toUpperCase() + maxExpression.slice(1);
                        confidenceDisplay.textContent = `${confidence}%`;
                    }
                }
            } catch (error) {
                console.error('Error detecting face:', error);
            }
            
            // Continue detection
            requestAnimationFrame(detectFace);
        }
        
        // Start webcam
        async function startCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: "user" } 
                });
                
                video.srcObject = stream;
                video.style.display = 'block';
                placeholder.style.display = 'none';
                
                // Wait for video to load metadata
                video.addEventListener('loadedmetadata', () => {
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    
                    // Initialize face detection after video starts
                    initFaceDetection();
                });
                
                roastBtn.disabled = false;
                startBtn.textContent = "Camera Started";
                startBtn.disabled = true;
            } catch (error) {
                console.error('Error accessing camera:', error);
                roastDisplay.textContent = "Camera access denied. Please enable your camera and refresh.";
            }
        }
        
        // Generate roast based on expression
        function generateRoast() {
            const expressionRoasts = roasts[currentExpression] || roasts.neutral;
            const randomRoast = expressionRoasts[Math.floor(Math.random() * expressionRoasts.length)];
            
            roastDisplay.textContent = randomRoast;
            
            // Add animation effect
            roastDisplay.style.transform = "scale(1.1)";
            setTimeout(() => {
                roastDisplay.style.transform = "scale(1)";
            }, 300);
        }
        
        // Event Listeners
        startBtn.addEventListener('click', startCamera);
        roastBtn.addEventListener('click', generateRoast);
        
        // Initial setup
        roastBtn.disabled = true;
    </script>
</body>
</html>